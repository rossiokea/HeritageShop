{% extends 'base.html' %}
{% load static from static %}
{% block content %}
    <section class="bg-light">
        <div class="container">
            <div class="row border border-2 border-dark kr_background_search rounded">
                <!-- Start Search Section-->
                <div class="row ">
                    <div class="col-md-2">
                        <img src="{% static 'dump-truck.png' %}" alt="" width="60" height="60">
                    </div>

                    <div class="col-md-4  justify-content-start d-flex align-items-center search_heading"> {{ object_list.count }}
                        Vehicles found {{ vehicles_page_obj }}
                    </div>

                    <div class="col-md-6 ">
                        <div class="row">
                            <form id=search_vehicles action="{% url 'shop:search_vehicles' %}"
                                  class="mt-2 mb-2 text-center form-inline">

                                <select class="align-top" name="item_status" id="item_status">
                                    {% if not selected_item_status %}
                                        <option value="Active" selected>Active</option>
                                        <option value="Inactive">Inactive</option>
                                    {% elif selected_item_status == 'Active' %}
                                        <option value="Active" selected>Active</option>
                                        <option value="Inactive">Inactive</option>
                                    {% elif selected_item_status == 'Inactive' %}
                                        <option value="Active">Active</option>
                                        <option value="Inactive" selected>Inactive</option>
                                    {% endif %}
                                </select>

                                <select class="align-top" id=department name="department" class="mr-3">
                                    {% if not selected_department %}
                                        <option value="" selected> All Departments</option>
                                        <option value=10>Construction (10)</option>
                                        <option value=20>Maintenance (20)</option>
                                        <option value=50> Admin (50)</option>

                                    {% elif selected_department == '10' %}
                                        <option value=""> Select Department</option>
                                        <option value=10 selected>Construction (10)</option>
                                        <option value=20>Maintenance (20)</option>
                                        <option value=50> Admin (50)</option>

                                    {% elif selected_department == '20' %}
                                        <option value=""> All Departments</option>
                                        <option value=10>Construction (10)</option>
                                        <option value=20 selected>Maintenance (20)</option>
                                        <option value=50> Admin (50)</option>

                                    {% elif selected_department == '50' %}
                                        <option value=""> All Departments</option>
                                        <option value=10>Construction (10)</option>
                                        <option value=20>Maintenance (20)</option>
                                        <option value=50 selected> Admin (50)</option>
                                    {% endif %}
                                </select>
                                {% if selected_q == "" %}
                                    <input class="align-top" class="search w-30 ml-5" type="text" id='q' name="q"
                                           placeholder="Search...">
                                {% else %}
                                    <input class="align-top" class="search w-30 ml-5" type="text" id='q' name="q"
                                           value="{{ selected_q }}" placeholder="Search...">
                                {% endif %}

                                <button class="btn btn-secondary btn-outline-dark" type="submit">Search</button>
                                <button onclick="clearOptions()"
                                        class="btn btn-secondary btn-outline-dark" type="submit">Clear
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- End Search Section-->
            </div>
            <div class="row">
                {% for vehicle in vehicles_page_obj %}
                    <div class="col-md-6 col-lg-4">
                    <div class="wrap card p-2 border border-dark" style="width: 20rem; border-radius: 1.25rem; margin: .5rem">
                    <a href="{% url 'shop:detail_vehicles' pk=vehicle.pk %}"></a>
                    {#<img src="..." class="card-img-top" alt="..."> #}

                    {% if vehicle.next_service < today %}
                        <div class="card-body  border border-danger border-3 rounded-4">

                    {% elif vehicle.next_service < today_20 %}
                        <div class="card-body  border border-warning border-3 rounded-4">
                    {% else %}
                        <div class="card-body border">
                    {% endif %}

                <div class="card-title text-center fs-5">Vehicle: {{ vehicle.vehicle_identifier }}</div>
                <div class="row">
                    <div class="col-sm text-center text-muted">
                        License:
                    </div>
                    <div class="col-sm text-dark">{{ vehicle.vehicle_license }}</div>
                </div>
                <div class="row">
                    <div class="col-sm text-center text-muted">
                        VIN:
                    </div>
                    <div class="col-sm text-dark">
                        {{ vehicle.vehicle_vin }}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm text-center text-muted">
                        Short Name:
                    </div>
                    <div class="col-sm text-dark">
                        {{ vehicle.vehicle_short_name }}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm text-center text text-muted">Next Service</div>
                    {% if vehicle.next_service < today %}
                        <div class="col-sm fw-bold  border border-danger border-2 rounded">{{ vehicle.next_service }}</div>
                    {% elif vehicle.next_service <= today_20 %}
                        <div class="col-sm fw-bold  border border-warning border-2 rounded">{{ vehicle.next_service }}</div>
                    {% else %}
                        <div class="col-sm text-dark">{{ vehicle.next_service }}</div>
                    {% endif %}

                </div>

                <div class="row">
                    <div class="col-sm text-center text text-muted">
                        Assigned To:
                    </div>
                    <div class="col-sm text-dark">
                        {{ vehicle.assigned_employee }}
                    </div>
                </div>
                {#                <div class="row">#}
                {#                    <div class="col-sm text-center text text-muted">#}
                {#                        Status:#}
                {#                    </div>#}
                {#                    <div class="col-sm text-dark">#}
                {#                        {{ vehicle.get_vehicle_status_display }}#}
                {#                    </div>#}
                {#                </div>#}

                </div>

                </div>
                </div>
                {% endfor %}
                </div>
                </div>
            </div>
            <div class="row">
                <!--Start Vehicle Table Pagination -->
                <form action="">
                    <nav aria-label="..." class="text-center">
                        <div>
                            {% if vehicles_page_obj.has_previous %}
                                <a class="btn btn-outline-success mb-4"
                                   href="?page={{ num }}&department={{ selected_department }}&q={{ selected_q }}&item_status={{ selected_item_status }}">First</a>
                                <a class="btn btn-outline-success mb-4"
                                   href="?page={{ vehicles_page_obj.previous_page_number }}&department={{ selected_department }}&q={{ selected_q }}&item_status={{ selected_item_status }}">Previous</a>
                            {% endif %}

                            {% for num in vehicles_page_obj.paginator.page_range %}
                                {% if vehicles_page_obj.number == num %}
                                    <a class="btn btn-success mb-4"
                                       href="?page={{ num }}&department={{ selected_department }}&q={{ selected_q }}&item_status={{ selected_item_status }}">{{ num }}</a>
                                {% elif num > vehicles_page_obj.number|add:'-3' and num < vehicles_page_obj.number|add:'3' %}
                                    <a class="btn btn-outline-success mb-4"
                                       href="?page={{ num }}&department={{ selected_department }}&q={{ selected_q }}&item_status={{ selected_item_status }}">{{ num }}</a>
                                {% endif %}
                            {% endfor %}

                            {% if vehicles_page_obj.has_next %}
                                <a class="btn btn-outline-success mb-4"
                                   href="?page={{ vehicles_page_obj.next_page_number }}&department={{ selected_department }}&q={{ selected_q }}&item_status={{ selected_item_status }}">Next</a>
                                <a class="btn btn-outline-success mb-4"
                                   href="?page={{ vehicles_page_obj.paginator.num_pages }}&department={{ selected_department }}&q={{ selected_q }}&item_status={{ selected_item_status }}">Last</a>
                            {% endif %}
                        </div>
                        <!-- End Service Record Pagination -->
                    </nav>
                </form>
            </div>
        </div>
    </section>
{% endblock content %}
{% block extra_js %}
    <script type='text/javascript'>

        function clearOptions() {
            document.getElementById('q').value = ''
            document.getElementById('department').value = ''
            document.getElementById('item_status').value = 'Active'
        }
    </script>
{% endblock extra_js %}